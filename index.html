<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Friends SMS + Groups</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial}
body{margin:0;background:#0f172a;height:100vh;display:flex;align-items:center;justify-content:center;color:white}
.app{width:1000px;height:620px;background:#020617;border-radius:20px;display:flex;overflow:hidden}
.sidebar{width:280px;border-right:1px solid #1e293b;display:flex;flex-direction:column}
.header{padding:14px;border-bottom:1px solid #1e293b;font-weight:600}
.list{flex:1;overflow-y:auto}
.item{padding:12px 14px;border-bottom:1px solid #1e293b;cursor:pointer}
.item.active,.item:hover{background:#1e293b}
.controls{padding:10px;border-top:1px solid #1e293b;display:flex;gap:6px;flex-wrap:wrap}
.controls input{flex:1;padding:8px;border-radius:8px;border:none;background:#1e293b;color:white}
.controls button{padding:8px 10px;border:none;border-radius:8px;background:#2563eb;color:white;cursor:pointer}
.chat{flex:1;display:flex;flex-direction:column}
.messages{flex:1;padding:16px;overflow-y:auto;display:flex;flex-direction:column;gap:8px}
.bubble{max-width:70%;padding:10px 14px;border-radius:18px;font-size:14px}
.sent{align-self:flex-end;background:#2563eb;border-bottom-right-radius:4px}
.received{align-self:flex-start;background:#1e293b;border-bottom-left-radius:4px}
.input{display:flex;gap:8px;padding:12px;border-top:1px solid #1e293b}
.input input{flex:1;padding:10px;border-radius:20px;border:none;background:#1e293b;color:white}
.input button{padding:10px 16px;border:none;border-radius:20px;background:#2563eb;color:white}
.status{font-size:12px;color:#94a3b8}
.request-btn{padding:4px 6px;margin-left:6px;border:none;border-radius:6px;cursor:pointer}
.accept{background:#16a34a;color:white}
.deny{background:#dc2626;color:white}
.hidden{display:none}
</style>
</head>
<body>

<div id="login" style="width:360px;background:#020617;padding:20px;border-radius:16px">
  <h3>Enter Username</h3>
  <input id="usernameInput" placeholder="Username" style="width:100%;margin-bottom:8px;padding:10px"/>
  <button onclick="login()" style="width:100%">Enter</button>
</div>

<div class="app hidden" id="app">
  <div class="sidebar">
    <div class="header">Friends</div>
    <div class="list" id="friends"></div>
    <div class="header">Friend Requests</div>
    <div class="list" id="friendRequests"></div>
    <div class="header">Groups</div>
    <div class="list" id="groups"></div>
    <div class="controls">
      <input id="friendName" placeholder="Add friend" />
      <button onclick="sendFriendRequest()">Add</button>
      <input id="groupName" placeholder="New group" />
      <button onclick="createGroup()">Create</button>
    </div>
  </div>
  <div class="chat">
    <div class="header" id="chatHeader">Select a chat</div>
    <div class="status" id="presence"></div>
    <div class="messages" id="messages"></div>
    <div class="input">
      <input id="msg" placeholder="Message" />
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>
</div>

<script>
// ðŸ”¹ FIREBASE CONFIG - REPLACE WITH YOURS
const firebaseConfig = {
  apiKey: "PASTE_API_KEY",
  authDomain: "PROJECT.firebaseapp.com",
  databaseURL: "https://PROJECT.firebaseio.com",
  projectId: "PROJECT",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let user=null,currentChat=null,currentType=null;

// ðŸ”¹ LOGIN WITH USERNAME
function login(){
  const name=usernameInput.value.trim();
  if(!name)return alert('Enter username');
  user={username:name};
  document.getElementById('login').classList.add('hidden');
  document.getElementById('app').classList.remove('hidden');
  db.ref('users/'+name).set(true);
  setPresence();
  loadLists();
}

// ðŸ”¹ PRESENCE
function setPresence(){
  const ref=db.ref('presence/'+user.username);
  ref.set(true); ref.onDisconnect().remove();
}

// ðŸ”¹ FRIEND REQUESTS
function sendFriendRequest(){
  const name=friendName.value.trim();
  if(!name || name===user.username) return;
  db.ref('friendRequests/'+name+'/'+user.username).set(true);
  friendName.value='';
}

// Render friend requests with accept/deny buttons
function renderFriendRequests(){
  const list=document.getElementById('friendRequests');
  list.innerHTML='';
  db.ref('friendRequests/'+user.username).once('value',snap=>{
    snap.forEach(child=>{
      const u=child.key;
      const div=document.createElement('div');
      div.className='item';
      div.textContent=u;

      const acceptBtn=document.createElement('button');
      acceptBtn.className='request-btn accept';
      acceptBtn.textContent='Accept';
      acceptBtn.onclick=()=>acceptRequest(u);

      const denyBtn=document.createElement('button');
      denyBtn.className='request-btn deny';
      denyBtn.textContent='Deny';
      denyBtn.onclick=()=>denyRequest(u);

      div.appendChild(acceptBtn);
      div.appendChild(denyBtn);
      list.appendChild(div);
    });
  });
}

// Accept/deny logic
function acceptRequest(u){
  db.ref('friendRequests/'+user.username+'/'+u).remove();
  db.ref('friends/'+user.username+'/'+u).set(true);
  db.ref('friends/'+u+'/'+user.username).set(true);
  renderFriends();
  renderFriendRequests();
}

function denyRequest(u){
  db.ref('friendRequests/'+user.username+'/'+u).remove();
  renderFriendRequests();
}

// ðŸ”¹ FRIENDS
function renderFriends(){
  const list=document.getElementById('friends');
  list.innerHTML='';
  db.ref('friends/'+user.username).once('value',snap=>{
    snap.forEach(child=>{
      const u=child.key;
      const div=document.createElement('div');
      div.className='item';
      div.textContent=u;
      div.onclick=()=>openChat(u,'friend');
      list.appendChild(div);
    });
  });
}

// ðŸ”¹ GROUPS
function createGroup(){
  const name=groupName.value.trim();
  if(!name) return;
  const g=db.ref('groups/'+name);
  g.child('members/'+user.username).set(true);
  groupName.value='';
  renderGroups();
}

function renderGroups(){
  const list=document.getElementById('groups');
  list.innerHTML='';
  db.ref('groups').once('value',snap=>{
    snap.forEach(g=>{
      if(g.child('members/'+user.username).exists()){
        const div=document.createElement('div');
        div.className='item';
        div.textContent=g.key;
        div.onclick=()=>openChat(g.key,'group');
        list.appendChild(div);
      }
    });
  });
}

// ðŸ”¹ CHAT
function openChat(id,type){
  currentChat=id; currentType=type;
  document.getElementById('chatHeader').textContent=id;
  const messagesEl=document.getElementById('messages');
  messagesEl.innerHTML='';

  const path=type==='group'?`groups/${id}/messages`:`messages/${user.username}/${id}`;
  db.ref(path).off();
  db.ref(path).on('child_added',snap=>{
    const m=snap.val();
    const div=document.createElement('div');
    div.className='bubble '+m.type;
    div.textContent=m.text;
    messagesEl.appendChild(div);
    messagesEl.scrollTop=messagesEl.scrollHeight;
  });
}

// ðŸ”¹ SEND MESSAGE
function sendMessage(){
  if(!currentChat) return;
  const t=document.getElementById('msg').value.trim();
  if(!t) return;
  document.getElementById('msg').value='';

  if(currentType==='group'){
    db.ref(`groups/${currentChat}/messages`).push({text:t,type:'sent',from:user.username});
  }else{
    db.ref(`messages/${user.username}/${currentChat}`).push({text:t,type:'sent'});
    db.ref(`messages/${currentChat}/${user.username}`).push({text:t,type:'received'});
  }
}

// ðŸ”¹ UPDATE LISTS REGULARLY
setInterval(()=>{
  if(user){
    renderFriends();
    renderFriendRequests();
    renderGroups();
  }
},2000);
</script>

</body>
</html>
